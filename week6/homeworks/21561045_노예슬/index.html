<!doctype html>
<html lang="en" data-framework="jquery">
	<head>
		<meta charset="utf-8">
		<title>Interaction Programming</title>
		<link rel="stylesheet" href="./css/normalize.css">
		<link rel="stylesheet" href="./css/index.css">
	</head>
	<body>
		<p id="moveBottom" class="move">저를 아래쪽으로 이동시켜주세요.</p>
		<section>
			<div id="imageSlider" class="imageSlider">
				<ul id="sliderContainer" class="sliderContainer">
					<!-- 슬라이더 아이템의 위치 -->
				</ul>
				<div id="controller" class="controller">
					<button id="leftButton" class="left">왼쪽으로</button>
					<button id="rightButton" class="right">오른쪽으로</button>
				</div>
			</div>
			<p id="moveTop" class="move">저를 위쪽으로 이동시켜주세요.</p>
			<p id="error" class="error">저를 삭제해주세요.</p>
			<p id="test" class="test">저를 <span>수정</span>해주세요.</p>
		</section>

		<!-- Javascript -->
		<script type="text/javascript" src="./js/jquery.js"></script>
		<script type="text/javascript">
			//자바스크립트 코드 작성 영역
            //Quest2,3,4
            var imageNames = ['./imgs/image01.jpg', './imgs/image02.jpg', './imgs/image03.jpg'];
            $(document).ready(function(){
                for(var i = 0; i<imageNames.length; i++){
                        $('<li/>').append($('<img src="'+imageNames[i]+'">')).appendTo($('ul#sliderContainer'));
                    }
                //Quest1
                var $body = $('body');
                var $h1 = $('<h1>이미지슬라이더</h1>');
                $body.prepend($h1);

                //Quest5
                $('p#moveTop').prependTo($body);
                //Quest6
                $body.append($('p#moveBottom'));
                //Quest7
                $('p#error').remove();
                $('p#test').text('수정되었습니다');
                $('p#test').html('');    
                $('#imageSlider').css('overflow','hidden');
                $('#sliderContainer').children('li').css('float','left');
                $('#sliderContainer img').css('height','592px');
                //#sliderContainer노드의 CSS 속성 중 width를 자식노드 li의 width X 개수 로 변경합니다 > .css(properties);
                $('#sliderContainer').css('width', parseInt($('#sliderContainer').children('li').css('width')) * $('#sliderContainer').children('li').length);
                $('#leftButton').html('');
                $('#leftButton').text('move left');
                //$('#leftButton').html('왼쪽으로').text('move left');
                $('#rightButton').text('move right');
                //5
                $('#leftButton').css({'background-color':'#ff6600','color':'#ffffff'});
                //6
                $('#rightButton').css({'background-color':'#ff8899','color':'#ffffff'});
                //7

                var $sliderContainer = $('#sliderContainer');//컨텐츠를 추가할 container 노드를 미리 변수화
                var maxPage = imageNames.length;//슬라이드 컨텐츠의 길이를 정의
                var contentWidth = parseInt($sliderContainer.children('li').css('width'))//css를 통해 정의된 #sliderContaienr의 width를 할당
                var currentPage = 0;//왼쪽, 오른쪽 버튼 제어시 사용하기 위한 현재페이지 값을 생성
                var $leftButton = $('#leftButton');//왼쪽 버튼
                var $rightButton = $('#rightButton'); //오른쪽 버튼
                var isRolling = false; //애니메이션 진행 여부
                var rollingTimer = 0;//자동 슬라이드 타이머 변수



                //image01-02-03 => 03-01-02-03-01 으로 변경해주기위해 clone메서드 이용하여 노드복사, 추가
                //$sliderContainer.children().last() 은 $sliderContainer의 자식노드 중 마지막 노드(여기는 green 배경색을 가진 노드)를 clone 메서드를 이용해서 복제
                var cloneLast = $sliderContainer.children().last().clone();
                var cloneFirst = $sliderContainer.children().first().clone();
                // 복사한 green 노드를 $sliderContainer의 제일 앞에 추가
                $sliderContainer.prepend(cloneLast);
                $sliderContainer.append(cloneFirst);
                //여기까지 작성하고 테스트해볼 경우 첫 슬라이드 아이템이 red가 아닌 green이 되었음을 확인

                currentPage = 1;

                $sliderContainer.width((maxPage + 2) * contentWidth).css('margin-left', -1 * contentWidth);
                // 자동 슬라이드 구현을 위해 setInterval을 호출하고, rollingTimer에 반환값을 할당
                // rollingTimer는 clearInterval 함수를 이용해, interval를 해제하기 위해 활용
                /*rollingTimer = setInterval(function () {
                  currentPage += 1;
                  move(currentPage, contentWidth);
                }, 3000);*/
                // 자동슬라이드 구현을 위해 setInterval로 작성되었던 부분을 makeInterval 함수를 호출하는 코드로 변경.
                makeInterval(true);
                // $sliderContainer 의 mouseenter, mouseleave 이벤트 콜백을 추가, 해당 이벤트의 타입에 따라, interval을 제어하도록 코드를 구현
                $sliderContainer.on('mouseenter mouseleave', function (evt) {
                    if (evt.type === 'mouseenter') {
                    // mouseenter의 경우 interval을 해제
                    makeInterval(false);
                  } else {
                    // mouseleave의 경우 interval을 재생성
                    makeInterval(true);
                  }
                });

                $leftButton.on('click', function () {
                    // 애니메이션이 플레이중일때는 페이지의 증감이 이루어져선 안되므로, isRolling이 false인 경우에만 실행코드가 동작하도록 조건을 추가
                    if (isRolling === false) {
                        if (currentPage > 0) {
                          currentPage--;
                        } else {
                          currentPage = 0;
                        }
                        move(currentPage, contentWidth);
                    }
                });

                //오른쪽 버튼
                $rightButton.on('click', function (){
                    // 애니메이션이 플레이중일때는 페이지의 증감이 이루어져선 안되므로, isRolling이 false인 경우에만 실행코드가 동작하도록 조건을 추가
                    if (isRolling === false) {
                        if (currentPage < maxPage + 1) {
                          currentPage++;
                        } else {
                          currentPage = maxPage + 1;
                        }
                        move(currentPage, contentWidth);
                    }
                });

                function move(cPage, cWidth){
                    //애니메이션이 수행되므로 isRolling 에 true를 할당하여 애니메이션이 실행중임을 표시
                    isRolling = true;
                    //이동할 페이지:cPage, 컨텐츠의 width는 cWidth라는 이름으로 받기로 결정
                    $sliderContainer.animate({'margin-left': cPage * cWidth * -1},{
                        duration: 1000,
                        complete: function () {
                            //애니메이션이 끝난 후, isRolling에 false를 할당하여, 애니메이션이 모두 종료되었음을 표시
                            isRolling = false;
                            if (cPage === 0) {
                            // [0]번째 green은 [3]번째 green의 복제이므로, [0]green으로 페이지가 이동하는 경우, 원본의 위치로 이동하도록 변경하고, currentPage(현재페이지)를 원본 [3]green의 페이지인 maxPage로 변경
                            currentPage = maxPage;
                            $sliderContainer.css('margin-left', contentWidth * currentPage * -1);
                            } else if (cPage === maxPage + 1) {
                            // [4]번째 red는 [1]번째 red의 복제이므로, [4]red로 페이지가 이동하는 경우, 원본의 위치로 이동하도록 변경하고, currentPage(현재페이지)를 원본 [1]red의 페이지인 1로 변경
                            currentPage = 1;
                            $sliderContainer.css('margin-left', contentWidth * currentPage * -1);
                            }
                        }
                    });
                }
                
                // makeInterval 함수를 만들어 interval을 제어하도록 코드를 구현하고, 상단에 정의된 interval 생성 코드를 이동시킵니다.
                // interval 생성여부를 boolean 타입으로 받도록 매개변수 bool을 지정합니다.+        // interval 제어에 대한 코드를 별도 함수로 분리시킨 이유는 mouseenter/mouseleave 이벤트 발생시 interval을 제어하도록 추가해야하는데, 자동 슬라이드 구현시에도 해당 interval 기능을 사용하므로, 중복사용되는 interval 기능을 함수로 별도 선언하였습니다.
                function makeInterval(bool) {
                  if (bool) {
                    // bool 이 true로 들어올 경우 interval을 생성합니다.
                    rollingTimer = setInterval(function () {
                      currentPage += 1;
                      move(currentPage, contentWidth);
                    }, 3000);
                  } else {
                    // bool 이 false로 e들어올 경우 interval을 해제합니다.
                    clearInterval(rollingTimer);
                  }
                }  
                
            });
		</script>	
		
		
	</body>
</html>
