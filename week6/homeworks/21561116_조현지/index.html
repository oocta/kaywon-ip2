<!doctype html>
<html lang="en" data-framework="jquery">
	<head>
		<meta charset="utf-8">
		<title>Interaction Programming</title>
		<link rel="stylesheet" href="./css/normalize.css">
		<link rel="stylesheet" href="./css/index.css">
	</head>
	<body>
		<p id="moveBottom" class="move">저를 아래쪽으로 이동시켜주세요.</p>
		<section>
			<div id="imageSlider" class="imageSlider">
				<ul id="sliderContainer" class="sliderContainer">
					<!-- 슬라이더 아이템의 위치 -->
				</ul>
				<div id="controller" class="controller">
					<button id="leftButton" class="left">왼쪽으로</button>
					<button id="rightButton" class="right">오른쪽으로</button>
				</div>
			</div>
			<p id="moveTop" class="move">저를 위쪽으로 이동시켜주세요.</p>
			<p id="error" class="error">저를 삭제해주세요.</p>
			<p id="test" class="test">저를 <span>수정</span>해주세요.</p>
		</section>

		<!-- Javascript -->
		<script type="text/javascript" src="./js/jquery.js"></script>
		<script type="text/javascript">
			var imageNames = ['./imgs/image01.jpg', './imgs/image02.jpg', './imgs/image03.jpg']; //슬라이드용 배열데이터 준비
			var $sliderContainer = $('#sliderContainer'); //컨텐츠를 추가할 container 노드를 미리 변수화
			var maxPage = imageNames.length; //슬라이더 데이터의 수량을 maxPage에 할당. 슬라이드 컨텐츠의 길이를 정의
			var contentWidth = $sliderContainer.width(); //css를 통해 정의된 #sliderContainer의 width
			var currentPage = 0; //왼쪽, 오른쪽 버튼 제어시 사용하기 위한 현재페이지 변수
			var $leftButton = $('#leftButton'); //왼쪽 버튼
			var $rightButton = $('#rightButton'); //오른쪽 버튼
			var isRolling = false; //다중클릭 방지를 위해 현재 애니메이션 진행 여부를 체크. 'is~'접두어를 통해 Boolean값임을 정의. 처음 화면 진입시 애니메이션이 진행중이지 않으므로 기본값 false로 할당
			var rollingTimer = 0; //자동 슬라이드를 위해 setInterval 타이머 객체를 담기 위한 변수. 실행시 Number타입을 반환하므로, Number 0 으로 초기값을 할당
			
			$.each(imageNames, function (idx, val) {
				var $li = $('<li>'+'<img src='+val+'>'+'</li>');
				$sliderContainer.append($li); //li 노드 추가
			});
			
			/***** 5주차 *****/
			$('body').prepend('<h1>이미지슬라이더</h1>'); //Quest01
/*
			var imageNames = ['./imgs/image01.jpg', './imgs/image02.jpg', './imgs/image03.jpg'];
			for (i=0; i<imageNames.length; i++){
				var $li = $('<li></li>'); //Quest02
				var $img = $('<img>'); //Quest03
				$img.attr('src',imageNames[i]);
				$li.append($img); //Quest04
				$('ul#sliderContainer').append($li);
			}
*/
			$('body').prepend($('p#moveTop')); //Quest05
			$('body').append($('p#moveBottom')); //Quest06
			$('p#error').remove(); //Quest07
			$('p#test').html('수정되었습니다');
			$('p#test').html('');
			
			/***** 6주차 *****/
			$('#imageSlider').css('overflow','hidden'); //Quest01
			$('#sliderContainer li').css('float','left'); //Quest02
			$('#sliderContainer img').css('height','592px');
			$('#sliderContainer').css('width',parseInt($('#sliderContainer').children('li').css('width'))*$('#sliderContainer').children('li').length); //Quest03
			$('#leftButton').html('move left').css({ //Quest04~06
				'background-color':'#ff6600',
				'color':'#fff'
			});
			$('#rightButton').html('move right').css({
				'background-color':'#ff8899',
				'color':'#fff'
			});
			
			/***** 7주차 *****/
			var cloneLast = $sliderContainer.children().last().clone(); //무한 슬라이드를 위해 clone 메서드를 이용해서 노드를 복사 및 추가
			var cloneFirst = $sliderContainer.children().first().clone();
			$sliderContainer.prepend(cloneLast); //복사한 마지막 노드를 $sliderContainer의 제일 앞에 추가
			$sliderContainer.append(cloneFirst); //복사한 첫번째 노드를 $sliderContainer의 제일 뒤에 추가
			
/*
			$sliderContainer.width(maxPage * contentWidth); //$sliderContainer의 width를 추가된 li의 수량만큼 확장

			function move(cPage, cWidth) { //이동할 페이지와 넓이를 받을 수 있도록 함수를 작성
				$sliderContainer.animate({'margin-left': cPage * cWidth * -1 }, 1000); //이동할 페이지는 cPage, 컨텐츠의 width는 cWidth
			}
*/

			currentPage = 1; //복사된 2페이지 추가
			$sliderContainer.width((maxPage + 2) * contentWidth).css('margin-left', -1 * contentWidth); //$sliderContainer li 노드가 2개 증가했으므로 $sliderContainer의 width를 증가시킬때 2페이지 만큼 더 늘려줌. 첫 페이지가 변경되었으므로 원래 첫페이지로 위치시키기 위해 margin-left를 변경
			
			makeInterval(true); //setInterval을 호출하는 함수
			
			//$sliderContainer의 mouseenter, mouseleave 이벤트 콜백을 추가하고, 이벤트 타입에 따라 interval 제어
			$sliderContainer.on('mouseenter mouseleave', function (evt) {
				if (evt.type === 'mouseenter') {
					makeInterval(false); //mouseenter시 interval 해제
				} else {
					makeInterval(true); //mouseleave시 interval 재생성
				}
			});
			
			//왼쪽, 오른쪽 버튼에 이벤트 추가
			$leftButton.on('click', function () { //왼쪽으로 이동 시
				if (isRolling === false) { //애니메이션 종료일 때만 동작
					if (currentPage > 0) {
						currentPage--; //현재페이지가 1씩 감소
					} else {
						currentPage = 0; //최소값은 0으로 제한
					}
					move(currentPage, contentWidth); //실제 슬라이드를 움직이는 기능은 move 함수를 활용, 버튼클릭시 감소시킨 현재페이지를 contentWidth와 함께 전달
				}
			});
			$rightButton.on('click', function () { //오른쪽으로 이동 시
				if (isRolling === false) { //애니메이션이 종료일 때만 동작
					if (currentPage < maxPage + 1) { //currentPage가 0부터 시작하므로 "배열의 전체 길이 -1"을 최대페이지로 고정. 페이지수가 2페이지 증가되었으므로, 오른쪽 클릭시 최대 이동가능한 페이지를 조정해 - 1 + 2 => 1 로 변경
						currentPage++; //현재페이지가 1씩 증가
					} else {
						currentPage = maxPage + 1; //최대값일 때 maxPage로 할당
					}
					move(currentPage, contentWidth);
				}
			});
			
			function move(cPage, cWidth) {
				isRolling = true; //애니메이션이 실행중
				$sliderContainer.animate({'margin-left': cPage * cWidth * -1 }, {
					duration: 1000,
					complete: function () {
						isRolling = false; //애니메이션이 종료됨
						if (cPage === 0) { //[0]이미지3은 [3]이미지3의 복제이므로, [0]이미지3으로 페이지가 이동하는 경우, 원본의 위치로 이동하도록 변경하고, currentPage(현재페이지)를 원본 [3]이미지3의 페이지인 maxPage로 변경
							currentPage = maxPage;
							$sliderContainer.css('margin-left', contentWidth * currentPage * -1);
						} else if (cPage === maxPage + 1) { //[4]이미지1은 [1]이미지1의 복제이므로, [4]이미지1로 페이지가 이동하는 경우, 원본의 위치로 이동하도록 변경하고, currentPage(현재페이지)를 원본 [1]이미지1의 페이지인 1로 변경
							currentPage = 1;
							$sliderContainer.css('margin-left', contentWidth * currentPage * -1);
						}
					}
				});
			}
			
			//마우스 이벤트 발생시와 자동 슬라이드 구현시에 중복 사용되는 interval 기능을 함수로 별도 선언
			function makeInterval(bool) {
				if (bool) { //interval 생성 여부를 boolean 타입으로 받도록 매개변수 bool 지정
					//true이면 interval 생성
					rollingTimer = setInterval(function () {
						currentPage += 1;
						move(currentPage, contentWidth);
					}, 3000);
				} else {
					//false이면 interval 해제
					clearInterval(rollingTimer);
				}
			}
		</script>
	</body>
</html>
