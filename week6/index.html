<!doctype html>
<html lang="en" data-framework="jquery">
	<head>
		<meta charset="utf-8">
		<title>Interaction Programming</title>
		<link rel="stylesheet" href="./css/normalize.css">
		<link rel="stylesheet" href="./css/index.css">
	</head>
	<body>
		<section>
			<div id="imageSlider" class="imageSlider">
				<ul id="sliderContainer" class="sliderContainer">
					<!-- 슬라이더 아이템의 위치 -->
				</ul>
				<div id="controller" class="controller">
					<button id="leftButton" class="left">왼쪽으로</button>
					<button id="rightButton" class="right">오른쪽으로</button>
				</div>
				<div id="pagination" class="pagination">
					
				</div>
			</div>
		</section>

		<!-- Javascript -->
		<script type="text/javascript" src="./js/jquery.js"></script>
		<script type="text/javascript">
			//자바스크립트 코드 작성 영역
			//Step 7. #sliderContainer에 mouseenter 되는 경우 자동 슬라이드가 중지되고, mouseleave 이벤트가 발생하는 경우 interval이 다시 동작되어야 합니다.
			var colorsArray = ['red', 'blue', 'green'];
      
      $(document).ready(function () {
        
        var $sliderContainer = $('#sliderContainer');
        var maxPage = colorsArray.length; //슬라이드 컨텐츠의 길이를 정의합니다.
        var contentWidth = $sliderContainer.width(); // 슬라이드 컨텐츠 width
        var currentPage = 0; //현재페이지 변수
        var $leftButton = $('#leftButton'); // 왼쪽 버튼
        var $rightButton = $('#rightButton'); // 오른쪽 버튼
        var isRolling = false; // 애니메이션 진행 여부
        var rollingTimer = 0; // 자동 슬라이드 타이머 변수.
        
        $.each(colorsArray, function (idx, val) {
          var $li = $('<li/>', {'style': 'background-color:' + val});
          $sliderContainer.append($li);
        });
        
        var cloneLast = $sliderContainer.children().last().clone();
        var cloneFirst = $sliderContainer.children().first().clone();
        
        $sliderContainer.prepend(cloneLast);
        $sliderContainer.append(cloneFirst);
        
        //복사된 2페이지가 추가되었으므로 currentPage를 1로 업데이트했어야 하는데, 누락되었습니다.
        //참고 바랍니다.
        currentPage = 1;
        $sliderContainer.width((maxPage + 2) * contentWidth).css('margin-left', -1 * contentWidth);
        
        // 자동슬라이드 구현을 위해 setInterval로 작성되었던 부분을 makeInterval 함수를 호출하는 코드로 변경하였습니다.
        makeInterval(true);
        
        $leftButton.on('click', function () {
          if (isRolling === false) {
            if (currentPage > 0) {
              currentPage--;
            } else {
              currentPage = 0;
            }
            
            move(currentPage, contentWidth);
          }
        });
        
        
        $rightButton.on('click', function () {
          if (isRolling === false) {
            if (currentPage < maxPage + 1) {
              currentPage++;
            } else {
              currentPage = maxPage + 1;
            }
            move(currentPage, contentWidth);
          }
        });
        
        function move(cPage, cWidth) {
          
          isRolling = true;
          
          $sliderContainer.animate({'margin-left': cPage * cWidth * -1 }, {
            duration: 1000,
            complete: function () {
              isRolling = false;
              if (cPage === 0) {
                currentPage = maxPage;
                $sliderContainer.css('margin-left', contentWidth * currentPage * -1);
              } else if (cPage === maxPage + 1) {
                currentPage = 1;
                $sliderContainer.css('margin-left', contentWidth * currentPage * -1);
              }
            }
          });
          
        }
        
        // makeInterval 함수를 만들어 interval을 제어하도록 코드를 구현하고, 상단에 정의된 interval 생성 코드를 이동시킵니다.
        // interval 생성여부를 boolean 타입으로 받도록 매개변수 bool을 지정합니다.
        // interval 제어에 대한 코드를 별도 함수로 분리시킨 이유는 mouseenter/mouseleave 이벤트 발생시 interval을 제어하도록 추가해야하는데, 자동 슬라이드 구현시에도 해당 interval 기능을 사용하므로, 중복사용되는 interval 기능을 함수로 별도 선언하였습니다.
        function makeInterval(bool) {
          if (bool) {
            // bool 이 true로 들어올 경우 interval을 생성합니다.
            rollingTimer = setInterval(function () {
              currentPage += 1;
              move(currentPage, contentWidth);
            }, 3000);
          } else {
            // bool 이 false로 e들어올 경우 interval을 해제합니다.
            clearInterval(rollingTimer);
          }
        }
        
      });
      
		</script>
	</body>
</html>
